# æ°´æ³µæˆ¿ç›‘æ§ç³»ç»Ÿ - ä»£ç å®¡æŸ¥æŠ¥å‘Š

> **å®¡æŸ¥æ—¥æœŸ**: 2024-12-30
> **å®¡æŸ¥è§’è‰²**: èµ„æ·±PLCä¸Šä½æœºå¼€å‘å·¥ç¨‹å¸ˆ
> **é¡¹ç›®**: ceramic-waterpump-flutter + ceramic-waterpump-backend

---

## ğŸ“Š æ€»ä½“è¯„ä»·

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|-----|------|------|
| æ¶æ„è®¾è®¡ | â­â­â­â­ | å‰åç«¯åˆ†ç¦»ï¼Œç»“æ„æ¸…æ™° |
| ä»£ç è´¨é‡ | â­â­â­â­ | æ¨¡å—åŒ–è‰¯å¥½ï¼Œå¯è¯»æ€§å¼º |
| å·¥ä¸šé€‚ç”¨æ€§ | â­â­â­ | å­˜åœ¨æ”¹è¿›ç©ºé—´ |
| å¼‚å¸¸å¤„ç† | â­â­â­ | åŸºç¡€å®Œå–„ï¼Œéœ€åŠ å¼º |
| å®‰å…¨æ€§ | â­â­ | éœ€è¦åŠ å¼º |

---

## ğŸ”´ ä¸¥é‡é—®é¢˜ (å¿…é¡»ä¿®å¤)

### 1. å®æ—¶ç›‘æ§é¡µé¢ä½¿ç”¨ç¡¬ç¼–ç æ•°æ®

**ä½ç½®**: [split_screen_page.dart](lib/pages/split_screen_page.dart#L39-L70)

```dart
// å½“å‰é—®é¢˜ï¼šé¡µé¢ä½¿ç”¨ç¡¬ç¼–ç æ•°æ®ï¼Œæ²¡æœ‰ä½¿ç”¨ RealtimeService
_buildPumpCard('#1', 45.2, 320.5, 30.1, 29.8, 30.3, true, vibration: 0.85, pressure: 0.65),
```

**å½±å“**: å®æ—¶ç›‘æ§é¡µé¢æ˜¾ç¤ºçš„æ˜¯å›ºå®šå€¼ï¼Œä¸æ˜¯åç«¯å®é™…æ•°æ®ï¼

**å»ºè®®**:
```dart
// åº”è¯¥ä½¿ç”¨ RealtimeService è·å–çš„æ•°æ®
final pump = _realtimeData?.getPump(1);
_buildPumpCard(
  '#1',
  pump?.power ?? 0.0,
  0.0, // energy éœ€è¦åç«¯æ”¯æŒ
  pump?.current ?? 0.0,
  pump?.current ?? 0.0,
  pump?.current ?? 0.0,
  pump?.isRunning ?? false,
  vibration: 0.0, // å¾…PLCæ¥å…¥
  pressure: _realtimeData?.pressure.value,
),
```

---

### 2. ç¼ºå°‘é€šä¿¡æ–­è¿æŠ¥è­¦æœºåˆ¶

**é—®é¢˜**: å½“åç«¯æˆ–PLCæ–­è¿æ—¶ï¼Œåªæœ‰å°å›¾æ ‡å˜ç°ï¼Œæ²¡æœ‰æ˜æ˜¾çš„æŠ¥è­¦æç¤º

**å·¥ä¸šè¦æ±‚**: PLCé€šä¿¡ä¸­æ–­æ˜¯**ä¸¥é‡æ•…éšœ**ï¼Œå¿…é¡»æœ‰ä»¥ä¸‹æœºåˆ¶ï¼š

- [ ] å£°éŸ³æŠ¥è­¦ (èœ‚é¸£)
- [ ] å…¨å±é—ªçƒæŠ¥è­¦æ¨ªå¹…
- [ ] æŠ¥è­¦å†å²è®°å½•
- [ ] è‡ªåŠ¨é‡è¿è®¡æ•°å™¨

**å»ºè®®å®ç°**:
```dart
// åœ¨ main_page.dart ä¸­æ·»åŠ 
if (!_plcHealthy && !_isHealthLoading) {
  _showCriticalAlarm('PLCé€šä¿¡ä¸­æ–­ï¼');
  _playAlarmSound();
  _logAlarmHistory('PLC_DISCONNECT', DateTime.now());
}
```

---

### 3. å¯†ç æ˜æ–‡å­˜å‚¨

**ä½ç½®**: [settings_page.dart](lib/pages/settings_page.dart#L25)

```dart
static const String _adminPassword = 'admin123';  // ç¡¬ç¼–ç æ˜æ–‡
```

**é—®é¢˜**:
- ç®¡ç†å‘˜å¯†ç ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
- æ“ä½œå‘˜å¯†ç æ˜æ–‡å­˜å‚¨åœ¨ SharedPreferences
- åç¼–è¯‘å³å¯è·å–å¯†ç 

**å»ºè®®**:
```dart
// 1. ä½¿ç”¨å“ˆå¸Œå­˜å‚¨
import 'package:crypto/crypto.dart';

String _hashPassword(String password) {
  final bytes = utf8.encode(password + 'salt_key');
  return sha256.convert(bytes).toString();
}

// 2. ç®¡ç†å‘˜å¯†ç åº”ä»åç«¯éªŒè¯ï¼Œä¸å­˜æœ¬åœ°
```

---

## ğŸŸ¡ é‡è¦é—®é¢˜ (å»ºè®®ä¿®å¤)

### 4. ç¼ºå°‘æ•°æ®æœ‰æ•ˆæ€§æ ¡éªŒ

**ä½ç½®**: [pump_data.dart](lib/models/pump_data.dart)

**é—®é¢˜**: æ²¡æœ‰æ ¡éªŒæ•°æ®åˆç†æ€§

```dart
// å½“å‰ä»£ç ç›´æ¥ä½¿ç”¨åç«¯æ•°æ®
voltage: (json['voltage'] as num?)?.toDouble() ?? 0.0,
```

**å·¥ä¸šç›‘æ§å¿…é¡»æ ¡éªŒ**:
- ç”µå‹èŒƒå›´: 0-500V
- ç”µæµèŒƒå›´: 0-100A
- åŠŸç‡èŒƒå›´: 0-100kW
- å‹åŠ›èŒƒå›´: 0-2MPa

**å»ºè®®**:
```dart
factory PumpData.fromJson(Map<String, dynamic> json) {
  final rawVoltage = (json['voltage'] as num?)?.toDouble() ?? 0.0;
  final rawCurrent = (json['current'] as num?)?.toDouble() ?? 0.0;
  
  // æ•°æ®æœ‰æ•ˆæ€§æ ¡éªŒ
  final voltage = rawVoltage.clamp(0.0, 500.0);
  final current = rawCurrent.clamp(0.0, 100.0);
  
  // å¼‚å¸¸å€¼æ ‡è®°
  final dataQuality = (rawVoltage == voltage && rawCurrent == current) 
      ? 'good' : 'bad';
  
  return PumpData(
    voltage: voltage,
    current: current,
    dataQuality: dataQuality,
    // ...
  );
}
```

---

### 5. è½®è¯¢é—´éš”ä¸åŒæ­¥

**å‰ç«¯**: 6ç§’è½®è¯¢å®æ—¶æ•°æ®
**åç«¯**: 5ç§’è½®è¯¢PLC + 30æ‰¹æ¬¡å†™å…¥ (150ç§’)

**é—®é¢˜**:
- å‰ç«¯å¯èƒ½å¤šæ¬¡è¯·æ±‚åŒä¸€æ•°æ®
- å†å²æ•°æ®æœ‰150ç§’å»¶è¿Ÿ

**å»ºè®®**:
- å‰ç«¯è½®è¯¢é—´éš”æ”¹ä¸º 5ç§’ (ä¸åç«¯åŒæ­¥)
- æˆ–ä½¿ç”¨ WebSocket æ¨é€ä»£æ›¿è½®è¯¢
- æ˜¾ç¤ºæ•°æ®æ¥æºæ—¶é—´æˆ³ï¼Œè®©ç”¨æˆ·çŸ¥é“æ•°æ®æ–°é²œåº¦

---

### 6. ç¼ºå°‘æ“ä½œå®¡è®¡æ—¥å¿—

**å·¥ä¸šç³»ç»Ÿè¦æ±‚**: æ‰€æœ‰å…³é”®æ“ä½œå¿…é¡»è®°å½•

åº”è®°å½•çš„æ“ä½œï¼š
- [ ] ç”¨æˆ·ç™»å½•/ç™»å‡º
- [ ] é˜ˆå€¼å‚æ•°ä¿®æ”¹
- [ ] å¯†ç ä¿®æ”¹
- [ ] ç³»ç»Ÿè®¾ç½®å˜æ›´

**å»ºè®®æ·»åŠ **:
```dart
class AuditLog {
  final DateTime timestamp;
  final String operator;
  final String action;
  final String details;
  final String ipAddress;
}

// ä¿®æ”¹é˜ˆå€¼æ—¶è®°å½•
void _saveThreshold() {
  _auditService.log(
    action: 'THRESHOLD_CHANGE',
    details: 'pump1_current: 50.0 -> 55.0',
    operator: _currentUser,
  );
}
```

---

### 7. å†å²æ•°æ®é¡µé¢ç¼ºå°‘å¯¼å‡ºåŠŸèƒ½

**å·¥ä¸šéœ€æ±‚**: å†å²æ•°æ®å¿…é¡»å¯å¯¼å‡ºç”¨äºåˆ†æå’Œå­˜æ¡£

**å»ºè®®æ·»åŠ **:
- [ ] å¯¼å‡º CSV/Excel
- [ ] å¯¼å‡º PDF æŠ¥è¡¨
- [ ] æ‰“å°åŠŸèƒ½
- [ ] æ•°æ®ç­›é€‰åå¯¼å‡º

---

### 8. ç¼ºå°‘è®¾å¤‡è¿è¡Œç»Ÿè®¡

**å·¥ä¸šéœ€æ±‚**: è¿ç»´äººå‘˜éœ€è¦ä»¥ä¸‹ç»Ÿè®¡æ•°æ®ï¼š

- [ ] å„æ³µè¿è¡Œæ—¶é•¿ç´¯è®¡
- [ ] å¯åœæ¬¡æ•°ç»Ÿè®¡
- [ ] æ•…éšœæ¬¡æ•°ç»Ÿè®¡
- [ ] èƒ½è€—ç»Ÿè®¡ (æ—¥/æœˆ/å¹´)

---

## ğŸŸ¢ æ”¹è¿›å»ºè®® (ä¼˜åŒ–ä½“éªŒ)

### 9. UI è§¦æ§ä¼˜åŒ–ä¸è¶³

**ç›®æ ‡è®¾å¤‡**: 10.4å¯¸è§¦æ‘¸å± (1280Ã—800)

**å½“å‰é—®é¢˜**:
- éƒ¨åˆ†æŒ‰é’®å¤ªå° (å·¥ä¸šè§¦æ‘¸å±å»ºè®®æœ€å° 48Ã—48px)
- è¾“å…¥æ¡†éœ€è¦è™šæ‹Ÿé”®ç›˜æ”¯æŒ
- ç¼ºå°‘æ‰‹æŒ‡è¯¯è§¦é˜²æŠ¤

**å»ºè®®**:
```dart
// å·¥ä¸šè§¦æ‘¸æŒ‰é’®æœ€å°å°ºå¯¸
const kIndustrialButtonMinSize = Size(48, 48);

// æŒ‰é’®é—´è·é˜²è¯¯è§¦
const kButtonSpacing = 16.0;
```

---

### 10. ç¼ºå°‘ç¦»çº¿æ¨¡å¼

**åœºæ™¯**: ç½‘ç»œä¸­æ–­æ—¶ï¼Œä¸Šä½æœºåº”è¯¥ï¼š
- [ ] æ˜¾ç¤ºæœ€åç¼“å­˜æ•°æ® + æ—¶é—´æˆ³
- [ ] æœ¬åœ°ç¼“å­˜æŠ¥è­¦è®°å½•
- [ ] ç½‘ç»œæ¢å¤åè‡ªåŠ¨é‡è¿
- [ ] ç¦»çº¿æœŸé—´æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œæ¢å¤ååŒæ­¥

---

### 11. ç¼ºå°‘å¤šè¯­è¨€æ”¯æŒæ¡†æ¶

è™½ç„¶å½“å‰æ˜¯ä¸­æ–‡ç•Œé¢ï¼Œä½†å·¥ä¸šè½¯ä»¶åº”é¢„ç•™å¤šè¯­è¨€æ¥å£ï¼š

```dart
// å»ºè®®ä½¿ç”¨ flutter_localizations + arb æ–‡ä»¶
// lib/l10n/app_zh.arb
{
  "pumpStatus": "æ°´æ³µçŠ¶æ€",
  "pressureAlarm": "å‹åŠ›æŠ¥è­¦"
}
```

---

### 12. çŠ¶æ€æœºè®¾è®¡ç¼ºå¤±

æ°´æ³µåº”æœ‰æ˜ç¡®çš„çŠ¶æ€æœºï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   å¯åŠ¨   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   æ•…éšœ   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  åœæ­¢   â”‚ â”€â”€â”€â”€â”€â”€â”€> â”‚  è¿è¡Œ   â”‚ â”€â”€â”€â”€â”€â”€â”€> â”‚  æ•…éšœ   â”‚
â”‚ STOPPED â”‚ <â”€â”€â”€â”€â”€â”€â”€ â”‚ RUNNING â”‚ <â”€â”€â”€â”€â”€â”€â”€ â”‚  FAULT  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   åœæ­¢   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   å¤ä½   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚                    â”‚
     â”‚       ç»´æŠ¤ä¸­       â”‚
     â””â”€â”€â”€â”€â”€â”€> MAINTENANCE <â”€â”€â”€â”€â”€â”€â”˜
```

å½“å‰ä»£ç åªç”¨ `isRunning` å¸ƒå°”å€¼ï¼Œæ— æ³•è¡¨è¾¾ç»´æŠ¤ã€æ•…éšœç­‰çŠ¶æ€ã€‚

---

## ğŸ“‹ åç«¯é—®é¢˜

### 13. Mock æ•°æ®ä¸å¤ŸçœŸå®

**ä½ç½®**: [mock_service.py](../ceramic-waterpump-backend/app/services/mock_service.py)

**é—®é¢˜**: éšæœºæ•°æ®æ— æ³•æ¨¡æ‹ŸçœŸå®åœºæ™¯

**å»ºè®®**:
- æ·»åŠ é¢„è®¾åœºæ™¯ï¼ˆæ­£å¸¸è¿è¡Œã€å¯åŠ¨è¿‡ç¨‹ã€æ•…éšœæ¨¡æ‹Ÿï¼‰
- æ¨¡æ‹ŸçœŸå®çš„ç”µæœºå¯åŠ¨ç”µæµæ›²çº¿
- æ¨¡æ‹Ÿæ¸å˜è¿‡ç¨‹è€Œéè·³å˜

---

### 14. InfluxDB æ•°æ®ä¿ç•™ç­–ç•¥

**é—®é¢˜**: æœªé…ç½®æ•°æ®ä¿ç•™ç­–ç•¥ï¼Œé•¿æœŸè¿è¡Œä¼šå æ»¡ç£ç›˜

**å»ºè®®**:
```python
# é…ç½®æ•°æ®ä¿ç•™ç­–ç•¥
# åŸå§‹æ•°æ®ä¿ç•™ 7 å¤©
# 1åˆ†é’Ÿèšåˆä¿ç•™ 30 å¤©
# 1å°æ—¶èšåˆä¿ç•™ 1 å¹´
```

---

## âœ… åšå¾—å¥½çš„åœ°æ–¹

1. **æ¨¡å—åŒ–è®¾è®¡**: Servicesã€Providersã€Widgets åˆ†ç¦»æ¸…æ™°
2. **Docker éƒ¨ç½²**: ä¾¿äºéƒ¨ç½²å’Œè¿ç§»
3. **é˜ˆå€¼æŒä¹…åŒ–**: SharedPreferences å­˜å‚¨é˜ˆå€¼é…ç½®
4. **å¥åº·æ£€æŸ¥æœºåˆ¶**: å®šæœŸæ£€æŸ¥åç«¯çŠ¶æ€
5. **æ‰¹é‡å†™å…¥ä¼˜åŒ–**: åç«¯30æ‰¹æ¬¡å†™å…¥å‡å°‘IO
6. **PLC é•¿è¿æ¥**: é¿å…é¢‘ç¹è¿æ¥æ–­å¼€

---

## ğŸ¯ ä¼˜å…ˆçº§ä¿®å¤å»ºè®®

| ä¼˜å…ˆçº§ | é—®é¢˜ | å·¥ä½œé‡ |
|-------|------|-------|
| P0 | å®æ—¶é¡µé¢æ¥å…¥çœŸå®æ•°æ® | 2å°æ—¶ |
| P0 | é€šä¿¡æ–­è¿æŠ¥è­¦ | 4å°æ—¶ |
| P1 | æ•°æ®æœ‰æ•ˆæ€§æ ¡éªŒ | 2å°æ—¶ |
| P1 | å¯†ç åŠ å¯†å­˜å‚¨ | 3å°æ—¶ |
| P2 | æ“ä½œå®¡è®¡æ—¥å¿— | 4å°æ—¶ |
| P2 | å†å²æ•°æ®å¯¼å‡º | 6å°æ—¶ |
| P3 | è§¦æ§ä¼˜åŒ– | 3å°æ—¶ |
| P3 | ç¦»çº¿æ¨¡å¼ | 8å°æ—¶ |

---

## ğŸ“ æ€»ç»“

è¿™æ˜¯ä¸€ä¸ª**æ¶æ„åˆç†ã€ä»£ç è´¨é‡è¾ƒå¥½**çš„å·¥ä¸šç›‘æ§ç³»ç»ŸåŸå‹ã€‚ä¸»è¦é—®é¢˜é›†ä¸­åœ¨ï¼š

1. **å®æ—¶æ•°æ®æœªæ¥å…¥** - é¡µé¢æ˜¾ç¤ºç¡¬ç¼–ç æ•°æ®
2. **å·¥ä¸šçº§æŠ¥è­¦æœºåˆ¶ç¼ºå¤±** - é€šä¿¡æ•…éšœæ²¡æœ‰é†’ç›®æç¤º
3. **å®‰å…¨æ€§ä¸è¶³** - å¯†ç æ˜æ–‡å­˜å‚¨

å»ºè®®æŒ‰ä¼˜å…ˆçº§é€æ­¥å®Œå–„ï¼Œå…ˆç¡®ä¿æ ¸å¿ƒç›‘æ§åŠŸèƒ½æ­£å¸¸å·¥ä½œï¼Œå†è¡¥å……å®‰å…¨å’Œä½“éªŒä¼˜åŒ–ã€‚

---

*å®¡æŸ¥äºº: GitHub Copilot (Claude Opus 4.5)*
*å®¡æŸ¥æ—¥æœŸ: 2024-12-30*
